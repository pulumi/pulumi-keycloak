// *** WARNING: this file was generated by pulumi-language-nodejs. ***
// *** Do not edit by hand unless you're certain you know what you are doing! ***

import * as pulumi from "@pulumi/pulumi";
import * as utilities from "./utilities";

/**
 * Allows for creating and managing Kubernetes Identity Providers within Keycloak. Workloads inside a Kubernetes cluster can authenticate using service account tokens.
 *
 * > **NOTICE:**
 * This is part of a preview keycloak feature. You need to enable this feature to be able to use this resource.
 * More information about enabling the preview feature can be found here: https://www.keycloak.org/docs/latest/server_admin/index.html#_identity_broker_kubernetes
 *
 * ## Example Usage
 *
 * ### With An OpenID Client
 *
 * ### With A Kubernetes Workload Authentication
 *
 * ### Keycloak configuration
 *
 * ### Kubernetes workload
 *
 * In your Kubernetes workload, you need to mount a service account token with the right audience pointing to your Keycloak instance
 *
 * 1. Issuer URL of the Keycloak realm.
 * 2. Maximum time allowed by Kubernetes is 3600 seconds
 *
 * ### In the Pod, use curl to authenticate to Keycloak:
 *
 * ### And the response should look something like:
 *
 * > **NOTICE:**
 * Changing authentication flow bindings in your Realm settings can break existing clients' ability to authenticate, if not configured properly!
 *
 * ## Import
 *
 * Identity providers can be imported using the format `{{realm_id}}/{{idp_alias}}`, where `idpAlias` is the identity provider alias.
 *
 * Example:
 *
 * ```sh
 * $ pulumi import keycloak:index/kubernetesIdentityProvider:KubernetesIdentityProvider realm_identity_provider my-realm/my-idp
 * ```
 */
export class KubernetesIdentityProvider extends pulumi.CustomResource {
    /**
     * Get an existing KubernetesIdentityProvider resource's state with the given name, ID, and optional extra
     * properties used to qualify the lookup.
     *
     * @param name The _unique_ name of the resulting resource.
     * @param id The _unique_ provider ID of the resource to lookup.
     * @param state Any extra arguments used during the lookup.
     * @param opts Optional settings to control the behavior of the CustomResource.
     */
    public static get(name: string, id: pulumi.Input<pulumi.ID>, state?: KubernetesIdentityProviderState, opts?: pulumi.CustomResourceOptions): KubernetesIdentityProvider {
        return new KubernetesIdentityProvider(name, <any>state, { ...opts, id: id });
    }

    /** @internal */
    public static readonly __pulumiType = 'keycloak:index/kubernetesIdentityProvider:KubernetesIdentityProvider';

    /**
     * Returns true if the given object is an instance of KubernetesIdentityProvider.  This is designed to work even
     * when multiple copies of the Pulumi SDK have been loaded into the same process.
     */
    public static isInstance(obj: any): obj is KubernetesIdentityProvider {
        if (obj === undefined || obj === null) {
            return false;
        }
        return obj['__pulumiType'] === KubernetesIdentityProvider.__pulumiType;
    }

    /**
     * Enable/disable if new users can read any stored tokens. This assigns the broker.read-token role.
     */
    declare public readonly addReadTokenRoleOnCreate: pulumi.Output<boolean | undefined>;
    /**
     * The alias uniquely identifies an identity provider, and it is also used to build the redirect uri.
     */
    declare public readonly alias: pulumi.Output<string>;
    /**
     * Enable/disable authenticate users by default.
     */
    declare public readonly authenticateByDefault: pulumi.Output<boolean | undefined>;
    /**
     * Friendly name for Identity Providers.
     */
    declare public readonly displayName: pulumi.Output<string | undefined>;
    /**
     * Enable/disable this identity provider.
     */
    declare public readonly enabled: pulumi.Output<boolean | undefined>;
    declare public readonly extraConfig: pulumi.Output<{[key: string]: string} | undefined>;
    /**
     * Alias of authentication flow, which is triggered after first login with this identity provider. Term 'First Login' means that there is not yet existing Keycloak account linked with the authenticated identity provider account.
     */
    declare public readonly firstBrokerLoginFlowAlias: pulumi.Output<string | undefined>;
    /**
     * GUI Order
     */
    declare public readonly guiOrder: pulumi.Output<string | undefined>;
    /**
     * This is always set to true for Kubernetes identity provider.
     */
    declare public /*out*/ readonly hideOnLoginPage: pulumi.Output<boolean>;
    /**
     * Internal Identity Provider Id
     */
    declare public /*out*/ readonly internalId: pulumi.Output<string>;
    /**
     * The Kubernetes issuer URL of service account tokens. The URL <ISSUER>/.well-known/openid-configuration must be available to Keycloak.
     */
    declare public readonly issuer: pulumi.Output<string>;
    /**
     * If true, users cannot log in through this provider.  They can only link to this provider.  This is useful if you don't want to allow login from the provider, but want to integrate with a provider
     */
    declare public readonly linkOnly: pulumi.Output<boolean | undefined>;
    declare public readonly orgDomain: pulumi.Output<string | undefined>;
    declare public readonly orgRedirectModeEmailMatches: pulumi.Output<boolean | undefined>;
    /**
     * ID of organization with which this identity is linked.
     */
    declare public readonly organizationId: pulumi.Output<string | undefined>;
    /**
     * Alias of authentication flow, which is triggered after each login with this identity provider. Useful if you want additional verification of each user authenticated with this identity provider (for example OTP). Leave this empty if you don't want any additional authenticators to be triggered after login with this identity provider. Also note, that authenticator implementations must assume that user is already set in ClientSession as identity provider already set it.
     */
    declare public readonly postBrokerLoginFlowAlias: pulumi.Output<string | undefined>;
    /**
     * Provider ID, is always kubernetes.
     */
    declare public readonly providerId: pulumi.Output<string | undefined>;
    /**
     * The name of the realm. This is unique across Keycloak.
     */
    declare public readonly realm: pulumi.Output<string>;
    /**
     * Enable/disable if tokens must be stored after authenticating users.
     */
    declare public readonly storeToken: pulumi.Output<boolean | undefined>;
    /**
     * Sync Mode
     */
    declare public readonly syncMode: pulumi.Output<string | undefined>;
    /**
     * If enabled then email provided by this provider is not verified even if verification is enabled for the realm.
     */
    declare public readonly trustEmail: pulumi.Output<boolean | undefined>;

    /**
     * Create a KubernetesIdentityProvider resource with the given unique name, arguments, and options.
     *
     * @param name The _unique_ name of the resource.
     * @param args The arguments to use to populate this resource's properties.
     * @param opts A bag of options that control this resource's behavior.
     */
    constructor(name: string, args: KubernetesIdentityProviderArgs, opts?: pulumi.CustomResourceOptions)
    constructor(name: string, argsOrState?: KubernetesIdentityProviderArgs | KubernetesIdentityProviderState, opts?: pulumi.CustomResourceOptions) {
        let resourceInputs: pulumi.Inputs = {};
        opts = opts || {};
        if (opts.id) {
            const state = argsOrState as KubernetesIdentityProviderState | undefined;
            resourceInputs["addReadTokenRoleOnCreate"] = state?.addReadTokenRoleOnCreate;
            resourceInputs["alias"] = state?.alias;
            resourceInputs["authenticateByDefault"] = state?.authenticateByDefault;
            resourceInputs["displayName"] = state?.displayName;
            resourceInputs["enabled"] = state?.enabled;
            resourceInputs["extraConfig"] = state?.extraConfig;
            resourceInputs["firstBrokerLoginFlowAlias"] = state?.firstBrokerLoginFlowAlias;
            resourceInputs["guiOrder"] = state?.guiOrder;
            resourceInputs["hideOnLoginPage"] = state?.hideOnLoginPage;
            resourceInputs["internalId"] = state?.internalId;
            resourceInputs["issuer"] = state?.issuer;
            resourceInputs["linkOnly"] = state?.linkOnly;
            resourceInputs["orgDomain"] = state?.orgDomain;
            resourceInputs["orgRedirectModeEmailMatches"] = state?.orgRedirectModeEmailMatches;
            resourceInputs["organizationId"] = state?.organizationId;
            resourceInputs["postBrokerLoginFlowAlias"] = state?.postBrokerLoginFlowAlias;
            resourceInputs["providerId"] = state?.providerId;
            resourceInputs["realm"] = state?.realm;
            resourceInputs["storeToken"] = state?.storeToken;
            resourceInputs["syncMode"] = state?.syncMode;
            resourceInputs["trustEmail"] = state?.trustEmail;
        } else {
            const args = argsOrState as KubernetesIdentityProviderArgs | undefined;
            if (args?.alias === undefined && !opts.urn) {
                throw new Error("Missing required property 'alias'");
            }
            if (args?.issuer === undefined && !opts.urn) {
                throw new Error("Missing required property 'issuer'");
            }
            if (args?.realm === undefined && !opts.urn) {
                throw new Error("Missing required property 'realm'");
            }
            resourceInputs["addReadTokenRoleOnCreate"] = args?.addReadTokenRoleOnCreate;
            resourceInputs["alias"] = args?.alias;
            resourceInputs["authenticateByDefault"] = args?.authenticateByDefault;
            resourceInputs["displayName"] = args?.displayName;
            resourceInputs["enabled"] = args?.enabled;
            resourceInputs["extraConfig"] = args?.extraConfig;
            resourceInputs["firstBrokerLoginFlowAlias"] = args?.firstBrokerLoginFlowAlias;
            resourceInputs["guiOrder"] = args?.guiOrder;
            resourceInputs["issuer"] = args?.issuer;
            resourceInputs["linkOnly"] = args?.linkOnly;
            resourceInputs["orgDomain"] = args?.orgDomain;
            resourceInputs["orgRedirectModeEmailMatches"] = args?.orgRedirectModeEmailMatches;
            resourceInputs["organizationId"] = args?.organizationId;
            resourceInputs["postBrokerLoginFlowAlias"] = args?.postBrokerLoginFlowAlias;
            resourceInputs["providerId"] = args?.providerId;
            resourceInputs["realm"] = args?.realm;
            resourceInputs["storeToken"] = args?.storeToken;
            resourceInputs["syncMode"] = args?.syncMode;
            resourceInputs["trustEmail"] = args?.trustEmail;
            resourceInputs["hideOnLoginPage"] = undefined /*out*/;
            resourceInputs["internalId"] = undefined /*out*/;
        }
        opts = pulumi.mergeOptions(utilities.resourceOptsDefaults(), opts);
        super(KubernetesIdentityProvider.__pulumiType, name, resourceInputs, opts);
    }
}

/**
 * Input properties used for looking up and filtering KubernetesIdentityProvider resources.
 */
export interface KubernetesIdentityProviderState {
    /**
     * Enable/disable if new users can read any stored tokens. This assigns the broker.read-token role.
     */
    addReadTokenRoleOnCreate?: pulumi.Input<boolean>;
    /**
     * The alias uniquely identifies an identity provider, and it is also used to build the redirect uri.
     */
    alias?: pulumi.Input<string>;
    /**
     * Enable/disable authenticate users by default.
     */
    authenticateByDefault?: pulumi.Input<boolean>;
    /**
     * Friendly name for Identity Providers.
     */
    displayName?: pulumi.Input<string>;
    /**
     * Enable/disable this identity provider.
     */
    enabled?: pulumi.Input<boolean>;
    extraConfig?: pulumi.Input<{[key: string]: pulumi.Input<string>}>;
    /**
     * Alias of authentication flow, which is triggered after first login with this identity provider. Term 'First Login' means that there is not yet existing Keycloak account linked with the authenticated identity provider account.
     */
    firstBrokerLoginFlowAlias?: pulumi.Input<string>;
    /**
     * GUI Order
     */
    guiOrder?: pulumi.Input<string>;
    /**
     * This is always set to true for Kubernetes identity provider.
     */
    hideOnLoginPage?: pulumi.Input<boolean>;
    /**
     * Internal Identity Provider Id
     */
    internalId?: pulumi.Input<string>;
    /**
     * The Kubernetes issuer URL of service account tokens. The URL <ISSUER>/.well-known/openid-configuration must be available to Keycloak.
     */
    issuer?: pulumi.Input<string>;
    /**
     * If true, users cannot log in through this provider.  They can only link to this provider.  This is useful if you don't want to allow login from the provider, but want to integrate with a provider
     */
    linkOnly?: pulumi.Input<boolean>;
    orgDomain?: pulumi.Input<string>;
    orgRedirectModeEmailMatches?: pulumi.Input<boolean>;
    /**
     * ID of organization with which this identity is linked.
     */
    organizationId?: pulumi.Input<string>;
    /**
     * Alias of authentication flow, which is triggered after each login with this identity provider. Useful if you want additional verification of each user authenticated with this identity provider (for example OTP). Leave this empty if you don't want any additional authenticators to be triggered after login with this identity provider. Also note, that authenticator implementations must assume that user is already set in ClientSession as identity provider already set it.
     */
    postBrokerLoginFlowAlias?: pulumi.Input<string>;
    /**
     * Provider ID, is always kubernetes.
     */
    providerId?: pulumi.Input<string>;
    /**
     * The name of the realm. This is unique across Keycloak.
     */
    realm?: pulumi.Input<string>;
    /**
     * Enable/disable if tokens must be stored after authenticating users.
     */
    storeToken?: pulumi.Input<boolean>;
    /**
     * Sync Mode
     */
    syncMode?: pulumi.Input<string>;
    /**
     * If enabled then email provided by this provider is not verified even if verification is enabled for the realm.
     */
    trustEmail?: pulumi.Input<boolean>;
}

/**
 * The set of arguments for constructing a KubernetesIdentityProvider resource.
 */
export interface KubernetesIdentityProviderArgs {
    /**
     * Enable/disable if new users can read any stored tokens. This assigns the broker.read-token role.
     */
    addReadTokenRoleOnCreate?: pulumi.Input<boolean>;
    /**
     * The alias uniquely identifies an identity provider, and it is also used to build the redirect uri.
     */
    alias: pulumi.Input<string>;
    /**
     * Enable/disable authenticate users by default.
     */
    authenticateByDefault?: pulumi.Input<boolean>;
    /**
     * Friendly name for Identity Providers.
     */
    displayName?: pulumi.Input<string>;
    /**
     * Enable/disable this identity provider.
     */
    enabled?: pulumi.Input<boolean>;
    extraConfig?: pulumi.Input<{[key: string]: pulumi.Input<string>}>;
    /**
     * Alias of authentication flow, which is triggered after first login with this identity provider. Term 'First Login' means that there is not yet existing Keycloak account linked with the authenticated identity provider account.
     */
    firstBrokerLoginFlowAlias?: pulumi.Input<string>;
    /**
     * GUI Order
     */
    guiOrder?: pulumi.Input<string>;
    /**
     * The Kubernetes issuer URL of service account tokens. The URL <ISSUER>/.well-known/openid-configuration must be available to Keycloak.
     */
    issuer: pulumi.Input<string>;
    /**
     * If true, users cannot log in through this provider.  They can only link to this provider.  This is useful if you don't want to allow login from the provider, but want to integrate with a provider
     */
    linkOnly?: pulumi.Input<boolean>;
    orgDomain?: pulumi.Input<string>;
    orgRedirectModeEmailMatches?: pulumi.Input<boolean>;
    /**
     * ID of organization with which this identity is linked.
     */
    organizationId?: pulumi.Input<string>;
    /**
     * Alias of authentication flow, which is triggered after each login with this identity provider. Useful if you want additional verification of each user authenticated with this identity provider (for example OTP). Leave this empty if you don't want any additional authenticators to be triggered after login with this identity provider. Also note, that authenticator implementations must assume that user is already set in ClientSession as identity provider already set it.
     */
    postBrokerLoginFlowAlias?: pulumi.Input<string>;
    /**
     * Provider ID, is always kubernetes.
     */
    providerId?: pulumi.Input<string>;
    /**
     * The name of the realm. This is unique across Keycloak.
     */
    realm: pulumi.Input<string>;
    /**
     * Enable/disable if tokens must be stored after authenticating users.
     */
    storeToken?: pulumi.Input<boolean>;
    /**
     * Sync Mode
     */
    syncMode?: pulumi.Input<string>;
    /**
     * If enabled then email provided by this provider is not verified even if verification is enabled for the realm.
     */
    trustEmail?: pulumi.Input<boolean>;
}
